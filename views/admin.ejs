<!-- views/admin.ejs -->
<%
  const _openQs        = (typeof openQs        !== 'undefined' && Array.isArray(openQs))        ? openQs        : [];
  const _latestTopics  = (typeof latestTopics  !== 'undefined' && Array.isArray(latestTopics))  ? latestTopics  : [];
  const _latestUsers   = (typeof latestUsers   !== 'undefined' && Array.isArray(latestUsers))   ? latestUsers   : [];
  const _latestDealers = (typeof latestDealers !== 'undefined' && Array.isArray(latestDealers)) ? latestDealers : [];
  const _ok  = (typeof ok  !== 'undefined') ? ok  : '';
  const _err = (typeof err !== 'undefined') ? err : '';
%>
<section class="mx-auto max-w-6xl px-4 py-10 space-y-8">
  <!-- Header -->
  <div class="flex items-center justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold tracking-tight text-slate-900">Adminpanel</h1>
      <p class="text-slate-600">Översikt & åtgärder</p>
    </div>
  </div>

  <!-- Flash-meddelanden -->
  <% if (typeof ok !== 'undefined' && ok) { %>
    <div class="rounded-xl border border-emerald-200 bg-emerald-50 text-emerald-800 px-4 py-3 text-sm">
      <%= ok %>
    </div>
  <% } %>
  <% if (typeof err !== 'undefined' && err) { %>
    <div class="rounded-xl border border-red-200 bg-red-50 text-red-800 px-4 py-3 text-sm">
      <%= err %>
    </div>
  <% } %>

  <!-- Topp-rad: två smalare kort -->
  <div class="grid md:grid-cols-2 gap-6">
    <!-- Snabbåtgärder (smal container) -->
    <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-semibold text-slate-900 mb-4">Åtgärder</h2>
      <div class="flex flex-wrap gap-3">
        <!-- POST /admin/sync-dealers -->
        <form method="post" action="/admin/sync-dealers">
          <button type="submit"
                  class="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-4 py-2.5 font-medium shadow hover:bg-emerald-700">
            <i class="ti ti-refresh"></i> Synka dealers nu
          </button>
        </form>

        <!-- POST /admin/reindex -->
        <form method="post" action="/admin/reindex">
          <button type="submit"
                  class="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-4 py-2.5 font-medium shadow hover:bg-slate-800">
            <i class="ti ti-database-cog"></i> Bygg om sökindex
          </button>
        </form>
      </div>
      <p class="mt-3 text-xs text-slate-500">Åtgärder körs direkt och du skickas tillbaka hit med status.</p>
    </div>

    <!-- Snabba länkar (separat kort) -->
    <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-semibold text-slate-900 mb-4">Länkar</h2>
      <div class="flex flex-wrap gap-3">
        <a href="/admin/new-topic"
           class="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-4 py-2.5 font-medium shadow hover:bg-sky-700">
          <i class="ti ti-plus"></i> Nytt ämne
        </a>
        <a href="/admin/categories"
           class="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-4 py-2.5 font-medium shadow hover:bg-sky-700">
          <i class="ti ti-folders"></i> Kategorier
        </a>
        <a href="/admin-accounts"
           class="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-4 py-2.5 font-medium shadow hover:bg-indigo-700">
          <i class="ti ti-users"></i> Användare
        </a>
      </div>
      <p class="mt-3 text-xs text-slate-500">Genvägar till vanliga administrationsvyer.</p>
    </div>
  </div>

  <!-- Huvudrutnät: Öppna frågor / Senaste ämnen / Senaste dealers -->
  <div class="grid lg:grid-cols-3 gap-6">
    <!-- Öppna frågor -->
    <div class="rounded-2xl border border-slate-200 bg-white shadow-sm flex flex-col">
      <div class="px-5 py-4 border-b">
        <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
          <i class="ti ti-help-circle text-sky-600"></i> Öppna frågor
        </h3>
      </div>
      <div class="flex-1">
        <% if (!openQs || openQs.length === 0) { %>
          <div class="p-5 text-sm text-slate-500">Inga öppna frågor just nu.</div>
        <% } else { %>
          <ul class="divide-y divide-slate-200">
            <% openQs.forEach(q => { %>
              <li class="px-5 py-3 flex items-center justify-between hover:bg-slate-50">
                <div class="min-w-0">
                  <div class="font-medium text-slate-900 truncate"><%= q.title %></div>
                  <div class="text-xs text-slate-500 mt-0.5">
                    <%= new Date(q.created_at).toLocaleString('sv-SE') %>
                  </div>
                </div>
                <a href="/admin/questions/<%= q.id %>"
                   class="inline-flex items-center gap-1.5 text-sky-600 text-sm hover:underline shrink-0">
                  Öppna <i class="ti ti-arrow-right"></i>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </div>
      <div class="px-5 py-3 border-t">
        <a href="/admin/questions" class="text-sm text-sky-600 hover:underline inline-flex items-center gap-1">
          Visa alla frågor <i class="ti ti-arrow-right"></i>
        </a>
      </div>
    </div>

<!-- Senaste ämnen -->
<div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
  <div class="px-5 py-4 border-b">
    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
      <i class="ti ti-book text-sky-600"></i> Senaste ämnen
    </h3>
  </div>

  <% if (!_latestTopics || _latestTopics.length === 0) { %>
    <div class="p-5 text-sm text-slate-500">Inga ämnen ännu.</div>
  <% } else { %>
    <ul class="divide-y divide-slate-200">
      <% _latestTopics.forEach(t => { %>
        <li class="px-5 py-3 flex items-center justify-between hover:bg-slate-50">
          <div class="min-w-0">
            <div class="font-medium text-slate-900 truncate"><%= t.title %></div>
            <div class="text-xs text-slate-500 mt-0.5">
              Uppdaterad: <%= new Date(t.updated_at).toLocaleString('sv-SE') %>
            </div>
          </div>
          <div class="flex items-center gap-2 shrink-0">
            <a href="/topic/<%= t.id %>" class="text-slate-600 hover:underline text-sm">Visa</a>
            <a href="/admin/topic/<%= t.id %>/edit" class="inline-flex items-center gap-1.5 text-sky-600 text-sm hover:underline">
              Redigera <i class="ti ti-pencil"></i>
            </a>
          </div>
        </li>
      <% }) %>
    </ul>
  <% } %>
</div>

<!-- Senaste dealers -->
<div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
  <div class="px-5 py-4 border-b">
    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
      <i class="ti ti-building-store text-sky-600"></i> Senaste dealers
    </h3>
  </div>

  <% if (!_latestDealers || _latestDealers.length === 0) { %>
    <div class="p-5 text-sm text-slate-500">Inga dealers synkade ännu.</div>
  <% } else { %>
    <ul class="divide-y divide-slate-200">
      <% _latestDealers.forEach(d => { %>
        <li class="px-5 py-3 flex items-center justify-between hover:bg-slate-50">
          <div class="min-w-0">
            <div class="font-medium text-slate-900 truncate"><%= (d.firstname||'') + ' ' + (d.lastname||'') || d.company || d.email %></div>
            <div class="text-xs text-slate-500 mt-0.5">
              <span class="mr-2 rounded px-1.5 py-0.5 border text-[10px] <%= d.source==='nms' ? 'border-emerald-300 bg-emerald-50 text-emerald-700' : 'border-indigo-300 bg-indigo-50 text-indigo-700' %>">
                <%= (d.source||'').toUpperCase() %>
              </span>
              <%= d.email || '-' %> • Synkad: <%= new Date(d.updated_at).toLocaleString('sv-SE') %>
            </div>
          </div>
        </li>
      <% }) %>
    </ul>
  <% } %>
</div>
    </div>
  </div>
</section>