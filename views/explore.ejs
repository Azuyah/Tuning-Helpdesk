<section class="mx-auto max-w-6xl px-4 py-10 grid lg:grid-cols-4 gap-8">
  <!-- Sidebar -->
  <aside class="lg:col-span-1 space-y-6">
    <form method="get" action="/explore" class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
      <input type="hidden" name="tab" value="<%= tab %>">
      <label class="block text-sm font-medium text-slate-700">Sök</label>
      <input name="q" value="<%= q %>" placeholder="Sök i <%= tab==='topics'?'ämnen':'frågor' %>…"
             class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500">
      <div class="mt-3 flex items-center gap-2">
        <button class="rounded-lg bg-sky-600 text-white px-3 py-2 text-sm font-semibold hover:bg-sky-700">Sök</button>
        <a href="/explore?tab=<%= tab %>" class="text-sm text-slate-500 hover:underline">Rensa</a>
      </div>
    </form>

    <!-- Kategorier -->
    <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
      <div class="text-sm font-medium text-slate-700 mb-2">Kategorier</div>
      <ul class="space-y-1">
        <% categories.forEach(c => { %>
          <li>
            <a class="block rounded px-2 py-1 hover:bg-slate-50 <%= cat===c.id?'bg-slate-100 font-medium':'' %>"
               href="/explore?tab=<%= tab %>&cat=<%= encodeURIComponent(c.id) %><%= q?`&q=${encodeURIComponent(q)}`:'' %><%= tag?`&tag=${encodeURIComponent(tag)}`:'' %>">
              <%= c.title %>
            </a>
          </li>
        <% }) %>
      </ul>
    </div>

    <!-- Taggar -->
    <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
      <div class="text-sm font-medium text-slate-700 mb-2">Populära taggar</div>
      <div class="flex flex-wrap gap-2">
        <% tags.forEach(t => { %>
          <a href="/explore?tab=<%= tab %>&tag=<%= encodeURIComponent(t.name) %><%= q?`&q=${encodeURIComponent(q)}`:'' %><%= cat?`&cat=${encodeURIComponent(cat)}`:'' %>"
             class="text-xs rounded-full px-3 py-1 border border-slate-300 hover:border-sky-400 hover:text-sky-700 <%= tag===t.name?'bg-slate-100 font-medium':'' %>">
            <%= t.name %>
          </a>
        <% }) %>
      </div>
    </div>

<% const currentTab = (typeof tab === 'string' && tab) ? tab : 'all'; %>

<!-- Tabbyte -->
<div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
  <div class="text-sm font-medium text-slate-700 mb-2">Visa</div>
  <div class="flex flex-wrap gap-2">
    <a href="/explore"
       class="px-3 py-1.5 rounded-lg border <%= currentTab==='all' ? 'bg-sky-600 text-white border-sky-600' : 'border-slate-300 hover:bg-slate-50' %>">
      Alla
    </a>

    <a href="/explore?tab=topics"
       class="px-3 py-1.5 rounded-lg border <%= currentTab==='topics' ? 'bg-sky-600 text-white border-sky-600' : 'border-slate-300 hover:bg-slate-50' %>">
      Ämnen
    </a>

    <a href="/explore?tab=questions"
       class="px-3 py-1.5 rounded-lg border <%= currentTab==='questions' ? 'bg-sky-600 text-white border-sky-600' : 'border-slate-300 hover:bg-slate-50' %>">
      Frågor
    </a>

    <a href="/explore?tab=resources"
       class="px-3 py-1.5 rounded-lg border <%= currentTab==='resources' ? 'bg-sky-600 text-white border-sky-600' : 'border-slate-300 hover:bg-slate-50' %>">
      Resurser
    </a>
  </div>
</div>
</aside>

<!-- Lista -->
<div class="lg:col-span-3 space-y-6 min-w-0">
  <% if (tab === 'topics') { %>
    <h1 class="text-2xl font-bold text-slate-900">Alla ämnen</h1>
    <% if (!topics || topics.length === 0) { %>
      <div class="rounded-xl border border-slate-200 bg-white p-8 text-slate-600">
        Inga ämnen hittades.
      </div>
    <% } else { %>
      <!-- hard-stop any inherited max-width/mx-auto -->
      <div class="w-full mx-0" style="max-width:none">
        <ul class="w-full max-w-none divide-y divide-slate-200 border border-slate-200 rounded-xl bg-white shadow-sm">
          <% topics.forEach(t => { %>
            <li class="w-full px-5 py-4 flex justify-between items-center hover:bg-slate-50 transition">
              <div class="min-w-0">
                <div class="font-medium text-slate-800 truncate">
                  <a href="/topic/<%= t.id %>" class="hover:underline"><%= t.title %></a>
                </div>
                <% if (t.excerpt) { %>
                  <div class="text-xs text-slate-500 mt-1 line-clamp-2"><%= t.excerpt %></div>
                <% } %>
                <% if (t.tags) { %>
                  <div class="mt-2 flex flex-wrap gap-1">
                    <% t.tags.split(',').map(s=>s.trim()).filter(Boolean).forEach(tag => { %>
                      <a href="/explore?tab=topics&tag=<%= encodeURIComponent(tag.toLowerCase()) %><%= q?`&q=${encodeURIComponent(q)}`:'' %><%= cat?`&cat=${encodeURIComponent(cat)}`:'' %>"
                         class="text-[11px] rounded-full bg-slate-100 text-slate-600 px-2 py-0.5 hover:bg-slate-200">
                        <%= tag %>
                      </a>
                    <% }) %>
                  </div>
                <% } %>
              </div>
              <a href="/topic/<%= t.id %>" class="inline-flex items-center gap-1.5 text-sky-600 text-sm shrink-0 hover:underline">
                Visa <i class="ti ti-arrow-right"></i>
              </a>
            </li>
          <% }) %>
        </ul>
      </div>
    <% } %>
  <% } else { %>
    <h1 class="text-2xl font-bold text-slate-900">Alla frågor</h1>
    <% if (!questions || questions.length === 0) { %>
      <div class="rounded-xl border border-slate-200 bg-white p-8 text-slate-600">Inga frågor hittades.</div>
    <% } else { %>
      <ul class="w-full max-w-none divide-y divide-slate-200 border border-slate-200 rounded-xl bg-white shadow-sm">
        <% questions.forEach(q => { %>
          <li class="px-5 py-4 flex justify-between items-center hover:bg-slate-50 transition">
            <div class="min-w-0">
              <div class="font-medium text-slate-800 truncate"><%= q.title %></div>
              <div class="text-xs text-slate-500 mt-0.5">
                <%= new Date(q.created_at).toLocaleDateString('sv-SE') %> •
                <% const lbl = q.status==='answered'?'Besvarad': q.status==='closed'?'Stängd':'Öppen'; %>
                <span class="inline-flex items-center gap-1">
                  <span class="w-1.5 h-1.5 rounded-full <%= q.status==='answered'?'bg-emerald-500':q.status==='closed'?'bg-slate-400':'bg-amber-500' %>"></span>
                  <%= lbl %>
                </span>
              </div>
            </div>
            <a href="/questions/<%= q.id %>" class="inline-flex items-center gap-1.5 text-sky-600 text-sm hover:underline">
              Visa <i class="ti ti-arrow-right"></i>
            </a>
          </li>
        <% }) %>
      </ul>
    <% } %>
  <% } %>
</div>
</section>