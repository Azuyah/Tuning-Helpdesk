<!-- views/category.ejs -->
<section class="bg-gradient-to-b from-sky-50/60 to-transparent border-b border-slate-200 dark:border-slate-800">
  <div class="mx-auto max-w-6xl px-4 py-16">
    <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white">
      <%= (category && category.title) || categoryTitle || 'Kategori' %>
    </h1>
    <p class="mt-3 text-slate-600 dark:text-slate-400">
      Alla poster i denna kategori – ämnen, resurser och frågor.
    </p>
  </div>
</section>

<section class="mx-auto max-w-6xl px-4 py-12">
  <% 
    // FÖRVÄNTA: items från servern. Fallback till topics om items saknas.
    const list = Array.isArray(items) ? items : (
      Array.isArray(topics) 
        ? topics.map(t => ({ 
            id: t.id, 
            title: t.title, 
            excerpt: t.excerpt, 
            ts: t.updated_at, 
            type: (t.is_resource ? 'resource' : 'topic') 
          })) 
        : []
    );

    // Hjälp: säkra href om den inte skickats från servern
    function itemHref(it){
      if (it.href) return it.href;
      if (it.type === 'question') return '/questions/' + encodeURIComponent(it.id);
      if (it.type === 'resource') return '/resources/' + encodeURIComponent(it.id);
      return '/topic/' + encodeURIComponent(it.id);
    }
  %>

  <% if (!list.length) { %>
    <div class="flex justify-center">
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900/70 px-6 py-8 text-slate-600 dark:text-slate-300 max-w-xl w-full text-center shadow-sm">
        Inga poster hittades i denna kategori ännu.
      </div>
    </div>
  <% } else { %>
    <ul class="divide-y divide-slate-200 border border-slate-200 rounded-xl bg-white dark:bg-slate-900/70 dark:border-slate-800 shadow-sm">
      <% list.forEach(it => { 
           const href = itemHref(it);
      %>
        <li class="px-5 py-4 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-900 transition">
          <div class="min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <% if (it.type === 'resource') { %>
                <span class="text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700 border border-amber-200">Resurs</span>
              <% } else if (it.type === 'question') { %>
                <span class="text-[10px] px-1.5 py-0.5 rounded bg-violet-100 text-violet-700 border border-violet-200">Fråga</span>
              <% } else { %>
                <span class="text-[10px] px-1.5 py-0.5 rounded bg-sky-100 text-sky-700 border border-sky-200">Ämne</span>
              <% } %>

              <a href="<%= href %>" class="font-medium text-slate-800 dark:text-slate-100 hover:underline truncate max-w-[60ch]">
                <%= it.title %>
              </a>
            </div>

            <% if (it.excerpt) { %>
              <div class="text-xs text-slate-500 dark:text-slate-400 line-clamp-2"><%= it.excerpt %></div>
            <% } %>

            <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              <%= new Date(it.ts || Date.now()).toLocaleDateString('sv-SE') %>
            </div>
          </div>

          <a href="<%= href %>" class="inline-flex items-center gap-1.5 text-sky-600 text-sm hover:underline">
            Visa <i class="ti ti-arrow-right"></i>
          </a>
        </li>
      <% }) %>
    </ul>
  <% } %>

  <div class="mt-10 text-center">
    <a href="/" class="inline-flex items-center gap-2 text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white">
      <i class="ti ti-arrow-left"></i>
      Tillbaka till startsidan
    </a>
  </div>
</section>