<section class="mx-auto max-w-md px-4 py-12">
  <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-800 p-8">
    <h1 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Skapa konto</h1>

    <form id="regForm" class="space-y-6">
      <input type="hidden" name="next" value="<%= typeof next !== 'undefined' ? next : '/' %>">

      <!-- Namn -->
      <div>
        <label for="name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Namn</label>
        <input type="text" name="name" id="name"
               class="mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"/>
      </div>

      <!-- E-post -->
      <div>
        <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300">E-post</label>
        <input type="email" name="email" id="email" required
               class="mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"/>
      </div>

      <!-- Lösenord -->
      <div>
        <label for="password" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Lösenord</label>
        <input type="password" name="password" id="password" required
               class="mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"/>
      </div>

      <!-- Knapp -->
      <div class="pt-1">
        <button type="submit"
                class="w-full rounded-lg bg-sky-600 px-6 py-3 text-white font-semibold shadow hover:bg-sky-700">
          Skapa konto
        </button>
      </div>
    </form>

    <p class="mt-6 text-sm text-slate-600 dark:text-slate-400 text-center">
      Har du redan konto?
      <a href="/login" class="text-sky-600 hover:underline">Logga in</a>
    </p>
  </div>
</section>

<script>
  // Intercepta submit → POST till /api/auth/register → redirect
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('regForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const payload = {
        name: fd.get('name') || '',
        email: fd.get('email') || '',
        password: fd.get('password') || ''
      };

      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          alert(data.error || 'Kunde inte skapa konto.');
          return;
        }

        const next = fd.get('next') || '/';
        location.href = next;
      } catch (err) {
        alert('Nätverksfel. Försök igen.');
      }
    });
  });
</script>