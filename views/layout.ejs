<!doctype html>
<html lang="sv">
<head>
    <!-- Alternativ PNG-version -->
<link rel="icon" type="image/png" sizes="32x32" href="/public/favicon.png">
  <!-- Sätt tema TIDIGT (före CSS) för att undvika blink -->
  <script>
    (function () {
      try {
        const t = localStorage.getItem('theme');
        if (t === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      } catch(_) {}
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= title || 'Tuning Helpdesk' %></title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind config MÅSTE ligga EFTER scriptet ovan -->
   <script>
  window.tailwind = window.tailwind || {};
  tailwind.config = { darkMode: 'class' };
</script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          // valfritt att utöka
        }
      }
    }
  </script>

  <!-- Tabler Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css"/>

  <!-- Egen brandning -->
  <link rel="stylesheet" href="/public/brand.css" />
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 antialiased min-h-screen flex flex-col">
  <%- include('partials/header') %>

  <% if (showHero) { %>
    <%- include('partials/hero') %>
  <% } %>

  <main class="flex-1">
    <%- body %>
  </main>

  <%- include('partials/footer') %>

  <!-- Sid-specifika scripts (från vyer via express-ejs-layouts) -->
  <%- script %>

  <!-- Din gemensamma front-end (om du använder den) -->
  <script src="/public/home.js"></script>

  <% if (!user) { %>
<!-- Login-modal -->
<div id="loginModal" class="fixed inset-0 z-[9999] hidden">
  <!-- backdrop -->
  <div class="absolute inset-0 bg-black/40" data-login-close></div>

  <!-- dialog -->
  <div class="relative mx-auto mt-28 w-[92%] max-w-md rounded-2xl bg-white shadow-xl border border-slate-200">
    <div class="p-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 class="text-lg font-semibold text-slate-900">Logga in för att läsa frågor</h3>
          <p class="mt-1 text-sm text-slate-600">
            Du måste vara medlem för att kunna läsa frågor.
          </p>
        </div>
        <button class="rounded-lg p-2 text-slate-500 hover:bg-slate-100" data-login-close>
          <i class="ti ti-x"></i>
        </button>
      </div>

      <div class="mt-6 flex flex-col sm:flex-row gap-3">
        <a id="loginGo"
           class="flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-sky-600 text-white px-4 py-2.5 font-semibold hover:bg-sky-700">
          <i class="ti ti-login-2"></i> Logga in
        </a>
        <a id="registerGo"
           class="flex-1 inline-flex items-center justify-center gap-2 rounded-lg border border-slate-300 px-4 py-2.5 font-semibold text-slate-700 hover:bg-slate-50">
          <i class="ti ti-user-plus"></i> Skapa konto
        </a>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const modal = document.getElementById('loginModal');
  if (!modal) return;

  let nextHref = '/';
  function openModal(href){ nextHref = href || '/'; modal.classList.remove('hidden'); }
  function closeModal(){ modal.classList.add('hidden'); }

  // Stäng med backdrop/knapp/ESC
modal.addEventListener('click', (e) => {
  if (e.target.closest('[data-login-close]')) {
    closeModal();
  }
});
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

  // Fånga klick på frågor
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href^="/questions/"]');
    if (!a) return;
    // blockera navigation och visa modal
    e.preventDefault();
    openModal(a.getAttribute('href'));
  }, true);

  // Knappar → skicka med next
  const loginGo = document.getElementById('loginGo');
  const registerGo = document.getElementById('registerGo');
  const go = (base) => {
    const url = new URL(base, location.origin);
    url.searchParams.set('next', nextHref);
    location.href = url.toString();
  };
  loginGo?.addEventListener('click', () => go('/login'));
  registerGo?.addEventListener('click', () => go('/register'));

  // Autoöppna om server satte flagga (?loginModal=1)
  if (new URLSearchParams(location.search).get('loginModal') === '1') {
    openModal('/');
  }
})();
</script>
<% } %>
</body>
</html>