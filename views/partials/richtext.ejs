<!-- views/partials/richtext.ejs -->
<div id="richtext-host-<%= id %>"></div>

<template id="richtext-html-<%= id %>"><%- html %></template>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const host = document.getElementById('richtext-host-<%= id %>');
  const tpl  = document.getElementById('richtext-html-<%= id %>');
  if (!host || !tpl) return;

  // Skapa shadow root
  const root = host.attachShadow({ mode: 'open' });

  // Bas-typografi (helt isolerad från Tailwind resets)
  const style = document.createElement('style');
  style.textContent = `
    :host {
      display:block;
      color:#0f172a;
      font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
    }
    p { margin: 0 0 1rem; }
    h1 { font-size: 2rem; line-height: 1.25; margin: 1.5rem 0 .75rem; font-weight: 800; }
    h2 { font-size: 1.5rem; line-height: 1.3; margin: 1.25rem 0 .5rem; font-weight: 700; }
    h3 { font-size: 1.25rem; font-weight: 600; margin: 1rem 0 .5rem; }
    ul, ol { padding-left: 1.5rem; margin: 0 0 1rem; }
    ul { list-style: disc outside; }
    ol { list-style: decimal outside; }
    li { margin: .25rem 0; }
    a { color:#0369a1; text-decoration: underline; }
    img, iframe { max-width: 100%; height: auto; }
    iframe { display:block; aspect-ratio:16/9; width:100%; border:0; border-radius:12px; }
    hr { margin: 1.5rem 0; border:0; border-top:1px solid #e5e7eb; }
  `;

  // Klona HTML från template
  const fragment = tpl.content.cloneNode(true);

  // Lägg in i shadow root
  root.append(style, fragment);
});
</script>